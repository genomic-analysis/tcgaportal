<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TCGA portal</title>
    <!-- BOOTSTRAP STYLES-->
    <link href="../../assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONTAWESOME STYLES-->
    <link href="../../assets/css/font-awesome.css" rel="stylesheet" />
    <!-- CUSTOM STYLES-->
    <link href="../../assets/css/custom.css" rel="stylesheet" />
  </head>
  <body>
    <div class="navbar navbar-collapse" style="background:#DFDFDF; border: 2px solid #DFDFDF; font-size:120%;">
      <ul class="nav navbar-nav navbar-left" style="height=100px;">
	<a class="navbar-brand" href="../../index.html" ><font color="black" size=4px>TCGAportal</font></a>
	<li><a href="../../index.html">TCGA</a></li>
	<li><a href="../../Pan_cancer/index.html">Pan-cancer</a></li>
	<li><a href="../../download.html">Download</a></li>
	<li><a href="../../news.html">News</a></li>
	<li><a href="../../about.html">About</a></li>
      </ul> 
    </div>
    
    <nav class=" navbar-side" role="navigation" style="height:90%;padding-top:15px; background:#F5F5F5; overflow: auto;">
      <div class="sidebar" style="width:100%;height:100%;font-size:120%">  
	<ul class="nav" id="main-menu">
	  <li><a href="#"><span style="margin-left:20px"> Adrenal gland</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../AdrenalGland_TCGA_ACC/index.html">   TCGA-ACC</a></li>
	      <li><a href="../AdrenalGland_TCGA_PCPG/index.html">TCGA-PCPG</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Bild duct </span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../BileDuct_TCGA_CHOL/index.html">TCGA-CHOL</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Bladder </span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Bladder_TCGA_BLCA/index.html">TCGA-BLCA</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Blood</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Blood_TARGET_AML/index.html">TARGET-AML</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Bone Marrow </span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../BoneMarrow_TCGA_LAML/index.html">TCGA-LAML</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Brain</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Brain_TCGA_GBM/index.html">TCGA-GBM</a></li>
	      <li><a href="../Brain_TCGA_LGG/index.html">TCGA-LGG</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Breast</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Breast_TCGA_BRCA/index.html">TCGA-BRCA</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Cervix</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Cervix_TCGA_CESC/index.html">TCGA-CESC</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Colon</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Colon_TCGA_COAD/index.html">TCGA-COAD</a></li>
	      <li><a href="../Colon_TCGA_READ/index.html">TCGA-READ</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Esophagus</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Esophagus_TCGA_ESCA/index.html">TCGA-ESCA</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Eye</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Eye_TCGA_UVM/index.html">TCGA-UVM</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Head and neck</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../HeadAndNeck_TCGA_HNSC/index.html">TCGA-HNSC</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Kidney</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Kidney_TCGA_KIRC/index.html">TCGA-KIRC</a></li>
	      <li><a href="../Kidney_TCGA_KICH/index.html">TCGA-KICH</a></li>
	      <li><a href="../Kidney_TCGA_KIRP/index.html">TCGA-KIRP</a></li>
	      <li><a href="../Kidney_TARGET_RT/index.html">TARGET-RT</a></li>
	      <li><a href="../Kidney_TARGET_WT/index.html">TARGET-WT</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Liver</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Liver_TCGA_LIHC/index.html">TCGA-LIHC</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Lung</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Lung_TCGA_LUAD/index.html">TCGA-LUAD</a></li>
	      <li><a href="../Lung_TCGA_LUSC/index.html">TCGA-LUSC</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Lymph nodes</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../LymphNodes_TCGA_DLBC/index.html">TCGA-DLBC</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Nervous system</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../NervousSystem_TARGET_NBL/index.html">TARGET-NBL</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Ovary</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Ovary_TCGA_OV/index.html">TCGA-OV</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Pancreas</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Pancreas_TCGA_PAAD/index.html">TCGA-PAAD</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Pleura</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Pleura_TCGA_MESO/index.html">TCGA-MESO</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Prostate</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Prostate_TCGA_PRAD/index.html">TCGA-PRAD</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Skin</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Skin_TCGA_SKCM/index.html">TCGA-SKCM</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Softtissue</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../SoftTissue_TCGA_SARC/index.html">TCGA-SARC</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Stomach</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Stomach_TCGA_STAD/index.html">TCGA-STAD</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Testis</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Testis_TCGA_TGCT/index.html">TCGA-TGCT</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Thymus</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Thymus_TCGA_THYM/index.html">TCGA-THYM</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Thyroid</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Thyroid_TCGA_THCA/index.html">TCGA-THCA</a></li>
	    </ul>
	  </li>
	  <li><a href="#"><span style="margin-left:20px">Uterus</span> <span class="fa fa-angle-down" style="float:right; font-size:100%;"></span></a>
	    <ul class="nav nav-second-level" >
	      <li><a href="../Uterus_TCGA_UCEC/index.html">TCGA-UCEC</a></li>
	      <li><a href="../Uterus_TCGA_UCS/index.html">TCGA-UCS</a></li>
	    </ul>
	  </li>
	</ul>
      </div>
    </nav>
    
    <div style="margin-left:230px;padding:1px 16px;">
      <div id="page-inner" style="max-height:90vh;overflow:auto;">
	<center>
	  <?php
	    //<!--JS 页面自动刷新 auto refresh page-->
	    echo ("<script type=\"text/javascript\">");
	    echo ("function fresh_page()");    
	    echo ("{");
	    echo ("window.location.reload();");
	    echo ("}"); 
	    echo ("setTimeout('fre搜索sh_page()',1000);");      
	    echo ("</script>");

	    //-----------------------------------------------------------
	    $file = '../../visitor.log';
	    $current = file_get_contents($file);
	    $mydate=getdate(date("U"));
	    $current .= $_SERVER['REMOTE_ADDR']."\t"."$mydate[weekday], $mydate[month] $mydate[mday], $mydate[year].\t"."TCGA-BRCA"."\t".$_POST["geneName"]."\n";
	    file_put_contents($file, $current);
	    //--------------------------------------------------------------------
	    $GeneName=$_POST["geneName"];
	    echo $GeneName." ";
	    $devidePatient=$_POST["devidePatientN"];
	    echo $devidePatient." ";
	    $subtype=$_POST["subtype"];
	    echo $subtype." ".'<br>';
	    echo '<hr/>';
	    $parameterFile=fopen("Rparameter.txt","w");
	    $high="NA";
	    $low="NA";
	    if($devidePatient=="user"){ $high=$_POST["HighVal"]; $low=$_POST["LowVal"]; }
	    fwrite($parameterFile,"geneName\t$GeneName\n");
	    fwrite($parameterFile,"devidePatient\t$devidePatient\n");
	    fwrite($parameterFile,"lowCut\t$low\n");
	    fwrite($parameterFile,"highCut\t$high\n");
	    fwrite($parameterFile,"subtype\t$subtype\n");
	    fclose($parameterFile);
	    //-----------------------------------------------------------

	    //-----------------------------------------------------------query TCGA
	    if( $_POST["DataSet"]=="TCGA" ){
	    exec("grep -w $GeneName data/TCGA_BRCA_1222samples_FPKM_PAM50_scores_clinic_sort_geneName.txt > TCGA_expression.txt");
	    exec("cat TCGA_head.txt TCGA_expression.txt > TCGA_clinical_expression.txt");						       
	    $output="";						       
	    exec("Rscript TCGA_survival_curve.R 2>&1",$output);

	    echo '<img src="TCGA_survival_curve.png" border=0 height="40%" width="40%">';
	    echo '<img src="TCGA_high_low_expression.png" border=0 height="40%" width="40%">';
	    echo '<div align="right">';
	    echo '<a href="TCGA_expression_H.txt" download><input id="Submit" type="submit" value="Download high" /></a>';
	    echo '<a href="TCGA_expression_L.txt" download><input id="Submit" type="submit" value="Download low" /></a>';
	    echo '</div>';
	    echo '<br><hr/>';
	    //-----------------------------------------------------------
	    $output="";				      
	    exec("Rscript distribution_boxplot.R 2>&1",$output);				      
	    if(count($output)>8){
	  echo '<div class="row">';
	    echo '<div class="col-md-6">';
              echo '<img src="TCGA_tumor_sample_boxplot.png" border=0 height="80%" width="80%">';
	      echo '</div>';
	    echo '<div class="col-md-6">';
	      echo '<h4>Wilcoxon test</h4>';
	      echo "<table  class=\"table table-striped table-bordered table-hover\">\n";
		$f=fopen('TCGA_tumor_sample_boxplot.wilcox',"r");
		while(($line=fgetcsv($f)) !== false ){
		echo "<tr>";
		  foreach($line as $cell){
		  echo "<td>".htmlspecialchars($cell)."</td>";
		  }
		  echo "</tr>\n";
		}
		fclose($f);
		echo "\n</table>";
	      echo '<div align="right">';
		echo '<a href=TCGA_clinical_expression.txt download><input id="Submit" type="submit" value="Download data" /></a>';
		echo '</div>';
	      }else{ echo "!failed!".'<br>'; }		     
	      echo '</div>';
	    echo '</div>';
	  //-----------------------------------------------------------
	  $myfile = fopen("TCGA_expression_H.txt", "r") or die("Unable to show survival file!");
	  fclose($myfile);				      				    
	  $myfile = fopen("TCGA_expression_L.txt", "r") or die("Unable to show survival file!");				      
	  fclose($myfile);
	  }

	  //-------------------------------------METABRIC---------------
	  if( $_POST["DataSet"]=="METABRIC" ){
	  exec("grep -w $GeneName data/BRCA_METABRIC/EGAD00010000210_EGAD00010000211_ega-box-04_discovery_validation_ExpressionMatrix_PAM50_sortSubtype_clinic_OS_DFS.txt > METABRIC_expression_all.txt");
	  $figCount=0;
	  if( $file=fopen("METABRIC_expression_all.txt", "r") ){
          while( !feof($file) ){
          $line=fgets($file);
          $expression=fopen("METABRIC_expression.txt","w") or die("Unable to open file!");				
          fwrite($expression,$line);
          fclose($expression);

          exec("cat METABRIC_head.txt  METABRIC_expression.txt > METABRIC_clinical_expression.txt");
          $output="";						       
          exec("Rscript METABRIC_survival_curve.R 2>&1",$output);
          $figCount=$figCount+1;
          exec("cp METABRIC_survival_curve.png METABRIC_survival_curve_$figCount.png");
          if(count($output)>8){
          echo '<img src="METABRIC_survival_curve_'.$figCount.'.png" border=0>';
          $image='METABRIC_survival_curve_$figCount.png';

          }else{				      
          echo "failed! expression too low?".'<br>';
          }
          }
          fclose($file);
	  }
	  }

	  $figureName=glob("data/expression_methylation_figures/".$GeneName."_*png",GLOB_BRACE)[0];
	  echo '<br><hr/>';
	  echo '<div class="panel panel-default" style="width:80%; font-size:120%">';
	    echo '<div class="panel-heading" align="left"><b>Expression & methylation</b></div>';
	    echo '<br>';
	    echo '<left><b>Gene expression and its probe methylation in primary tumor and paired normal samples</b></left>';
	    echo '<br>';
	    echo '<img src="'.$figureName.'" height=100% width=100% alt="error">';
	    echo '<a href="data/expression_methylation_figures/'.$GeneName.'_expression_methylation.txt" download><input id="Submit" type="submit" value="Download data" /></a>';
	    echo '</div>';
	  ?>


		    <!--############################################################## VHL mutatuion type -->
	    <div>
	      <?php
		$figureName=glob("data/expression_cBioportal_mutation_figures/".$GeneName."_*png",GLOB_BRACE)[0];
		echo '<div class="panel panel-default" style="width:80%; font-size:120%">';
		echo '<div class="panel-heading" align="left"><b>Expression & mutation</b></div>';
		echo '<br>';
		echo "left panel is the permutatio test p-value of expression FPKM between driver mutated (red) and non-mutated (gray) samples";
		echo '<br>';
		echo '<img src="'.$figureName.'" height=100% width=100% alt="error">';
		$fileName=glob("data/expression_cBioportal_mutation_figures/".$GeneName."_*txt",GLOB_BRACE)[0];
		echo '<a href="'.$fileName.'" download><input id="Submit" type="submit" value="Download data" /></a>';
		echo '</div>';
		?>
	    </div>
	</center>
      </div>
    </div>
  </body>


  <!-- JQUERY SCRIPTS -->
  <script src="../../assets/js/jquery-1.10.2.js"></script>
  <!-- BOOTSTRAP SCRIPTS -->
  <script src="../../assets/js/bootstrap.min.js"></script>
  <!-- METISMENU SCRIPTS -->
  <script src="../../assets/js/jquery.metisMenu.js"></script>
  <!-- CUSTOM SCRIPTS -->
  <script src="../../assets/js/custom.js"></script>
  <script src="../../assets/js/jquery-1.9.1.min.js"></script>
  <script src="../../assets/js/jquery.autocomplete.min.js"></script>
  <script src="../../assets/js/currency-autocomplete.js"></script>  
</html>
